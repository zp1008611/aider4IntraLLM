---
name: Auto-label New Issues

on:
    issues:
        types: [opened]

permissions:
    issues: write

jobs:
    add-triage-label:
        runs-on: ubuntu-latest
        steps:
            - name: Add needs-triage label
              uses: actions/github-script@v7
              with:
                  github-token: ${{ secrets.ALLHANDS_BOT_GITHUB_PAT }}
                  script: |
                      // Get the issue details
                      const issue = context.payload.issue;
                      const labels = issue.labels.map(label => label.name);

                      // Check if issue has already been triaged
                      const hasEnhancement = labels.includes('enhancement');
                      const hasPriority = labels.some(label => label.startsWith('priority'));

                      // Only add needs-triage if not already triaged
                      if (!hasEnhancement && !hasPriority) {
                        await github.rest.issues.addLabels({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          issue_number: context.issue.number,
                          labels: ['needs-triage']
                        });
                      }
